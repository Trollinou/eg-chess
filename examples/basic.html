<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>eg-chess - Exemple basique</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cm-chessboard@8.10.1/assets/chessboard.css">
  <link rel="stylesheet" href="../dist/eg-chess.css">
  <script type="importmap">
  {
    "imports": {
      "cm-chessboard": "https://cdn.jsdelivr.net/npm/cm-chessboard@8.10.1/src/Chessboard.js",
      "cm-chessboard/": "https://cdn.jsdelivr.net/npm/cm-chessboard@8.10.1/",
      "chess.js": "https://cdn.jsdelivr.net/npm/chess.js@1.4.0/+esm"
    }
  }
  </script>
</head>
<body>
  <div class="eg-chess-container">
    <h1>eg-chess - Exemple</h1>
    <div id="board"></div>
    
    <div class="eg-chess-info">
      <div class="eg-chess-status" id="status">Tour des blancs</div>
      <div id="fen"></div>
    </div>
    
    <div class="eg-chess-controls">
      <button id="undo">Annuler</button>
      <button id="reset">Nouvelle partie</button>
    </div>
  </div>

  <script type="module">
    import { EGChess } from '../dist/eg-chess.js';

    const boardContainer = document.getElementById('board');
    // We provide the 'match' mode
    const chess = new EGChess(boardContainer, 'match');
    window.egChess = chess; // Expose for easier debugging

    const statusEl = document.getElementById('status');
    const fenEl = document.getElementById('fen');

    // Mise à jour de l'interface
    function updateStatus() {
        // Access the internal chess.js instance for game state
        const game = chess.chess;
        const turn = game.turn() === 'w' ? 'blancs' : 'noirs';

        if (game.isCheckmate()) {
            statusEl.textContent = 'Échec et mat!';
            statusEl.className = 'eg-chess-status checkmate';
        } else if (game.isDraw()) {
            statusEl.textContent = 'Match nul!';
            statusEl.className = 'eg-chess-status';
        } else if (game.isCheck()) {
            statusEl.textContent = `Échec! Tour des ${turn}`;
            statusEl.className = 'eg-chess-status check';
        } else {
            statusEl.textContent = `Tour des ${turn}`;
            statusEl.className = 'eg-chess-status';
        }

        // Use the public getFen() method
        fenEl.textContent = `FEN: ${chess.getFen()}`;
    }

    // Callbacks
    chess.on('onMove', (fen) => {
      console.log('Coup joué, nouveau FEN:', fen);
      updateStatus();
    });

    chess.on('onGameOver', () => {
        console.log('Partie terminée!');
        // We can add a more specific message if needed by a check on the game state
        if (chess.chess.isCheckmate()) {
            alert('Échec et mat!');
        } else {
            alert('Partie terminée!');
        }
    });

    // Boutons
    document.getElementById('undo').addEventListener('click', async () => {
      await chess.undo();
      updateStatus();
    });

    document.getElementById('reset').addEventListener('click', async () => {
      if (confirm('Nouvelle partie?')) {
        await chess.reset();
        updateStatus();
      }
    });

    // Initialisation
    updateStatus();
  </script>
</body>
</html>
